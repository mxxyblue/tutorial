<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hk.tuboard">
	<select id="tuboardlist" resultType="tuDto" parameterType="Map">
		SELECT TSEQ,TID,TTITLE,TCONTENT,TREGDATE,TREFER,TSTEP,TDEPTH,TREADCOUNT,TDELFLAG 
		FROM TUBOARD
		<where>
			<if test="tseq!=null">
				 TSEQ=#{tseq}		
			</if>		
		</where>
		ORDER BY TREFER DESC,TSTEP 
	</select>

	<insert id="insertboard" parameterType="tuDto">
		INSERT INTO TUBOARD
		VALUES (tuboard_seq.nextval, #{tid},#{ttitle},#{tcontent},SYSDATE
	, (SELECT NVL(max(TREFER),0)+1 FROM TUBOARD),0,0,0,'N')
	</insert>
	
	<update id="updateboard" parameterType="tuDto">
		UPDATE TUBOARD
		SET TTITLE=#{ttitle}, TCONTENT=#{tcontent},TREGDATE=SYSDATE 
		WHERE TSEQ=#{tseq} 
	</update>
	
	<!-- collection:배열객체, open:처음에 한번실행, close: 마지막에 한번 실행 , item:값을 받는 변수 -->
<!-- 	<update id="delboard" parameterType="Map"> -->
<!-- 		<![CDATA[ -->
<!-- 		UPDATE TUBOARD  -->
<!-- 		SET TDELFLAG = 'Y'  -->
<!-- 		WHERE TSEQ IN  -->
<!-- 		<foreach collection="seqs" item="tseq" open="(" close=")" separator=","> -->
<!--  			#{tseq} -->
<!-- 		</foreach> -->
<!-- 		]]> -->
<!-- 	</update> -->
		
		<delete id="deleteboard" parameterType="Map">
			<![CDATA[
		DELETE FROM TUBOARD 
		WHERE TSEQ IN
		<foreach collection="seqs" item="tseq" open="(" close=")" separator=",">
  			#{tseq}
 		</foreach>
 		
		]]>
		
		</delete>
	
	<update id="readcount" parameterType="int">
		<![CDATA[
		UPDATE TUBOARD
		SET TREADCOUNT=TREADCOUNT+1 
		WHERE TSEQ=#{tseq}
		]]>
	</update>
	
	<update id="replyupdate" parameterType="tuDto">
		<![CDATA[
		 UPDATE TUBOARD
		 SET TSTEP=TSTEP+1 
		 WHERE TREFER=(SELECT TREFER FROM TUBOARD WHERE TSEQ = #{tseq}) 
		 AND TSTEP > (SELECT TSTEP FROM TUBOARD WHERE TSEQ = #{tseq})
		 ]]>
	</update>
	
	<insert id="replyinsert" parameterType="tuDto">
		INSERT INTO TUBOARD
		VALUES(TUBOARD_SEQ.NEXTVAL,#{tid},#{ttitle},#{tcontent},SYSDATE 
		,(SELECT TREFER FROM TUBOARD WHERE TSEQ=#{tseq})
		,(SELECT TSTEP FROM TUBOARD WHERE TSEQ=#{tseq})+1 
		,(SELECT TDEPTH FROM TUBOARD WHERE TSEQ=#{tseq})+1, 0, 'N')
	</insert>
	
	<select id="recentlist" resultType="tuDto" parameterType="Map">
		<![CDATA[
		SELECT TSEQ,TID,TTITLE,TCONTENT,TREGDATE,TREFER,TSTEP,TDEPTH,TREADCOUNT,TDELFLAG 
		FROM 
		 (
	 	SELECT *
		FROM TUBOARD
		ORDER BY TREGDATE DESC
		 )
		WHERE ROWNUM <= 6 AND TSTEP=0
		]]>
	</select>

</mapper>








